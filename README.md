# Sistema de Gest√£o de SKUs - Grupo Botic√°rio

Sistema completo para gerenciamento de SKUs com fluxo de estados e regras de neg√≥cio espec√≠ficas, refatorado com **arquitetura de n√≠vel empresarial**.

## üöÄ Demonstra√ß√£o

- **Frontend**: http://localhost:3000
- **API**: http://localhost:3001
- **Documenta√ß√£o API (Swagger)**: http://localhost:3001/api-docs
- **Health Check**: http://localhost:3001/health

---

## üìã Sobre o Projeto

Este projeto implementa um sistema de gest√£o de SKUs com **arquitetura profissional** e as seguintes funcionalidades:

- ‚úÖ **CRUD completo** de SKUs
- ‚úÖ **Fluxo de estados** com transi√ß√µes controladas
- ‚úÖ **Regras de neg√≥cio** espec√≠ficas por status
- ‚úÖ **Valida√ß√£o de campos** edit√°veis por status
- ‚úÖ **Regra especial**: Edi√ß√£o da descri√ß√£o comercial em CADASTRO_COMPLETO retorna para PR√â-CADASTRO
- ‚úÖ **Interface responsiva** com Material-UI
- ‚úÖ **Documenta√ß√£o interativa** com Swagger
- ‚úÖ **Testes unit√°rios e de integra√ß√£o**

---

## üèóÔ∏è Arquitetura

### Distributed Microservices Architecture

```
sku-management/
‚îú‚îÄ‚îÄ sku-api/          # Backend API (Node.js + TypeScript)
‚îú‚îÄ‚îÄ sku-web/          # Frontend Web (React + TypeScript)
‚îî‚îÄ‚îÄ README.md
```

---

## üõ†Ô∏è Tecnologias Utilizadas

### Backend (sku-api)

| Categoria | Tecnologia | Finalidade |
|-----------|------------|------------|
| **Runtime** | Node.js 18+ | Ambiente de execu√ß√£o |
| **Linguagem** | TypeScript | Type safety e DX |
| **Framework** | Express.js | API RESTful |
| **Banco de Dados** | PostgreSQL | Persist√™ncia relacional |
| **ORM** | Prisma | Type-safe database access |
| **Valida√ß√£o** | Zod | Schema validation |
| **Documenta√ß√£o** | Swagger UI | API docs interativa |
| **Logs** | Winston | Logging estruturado |
| **Testes** | Jest + Supertest | Unit + Integration tests |
| **Container** | Docker + Docker Compose | Deployment |

### Frontend (sku-web)

| Categoria | Tecnologia | Finalidade |
|-----------|------------|------------|
| **Framework** | React 18 | Interface de usu√°rio |
| **Linguagem** | TypeScript | Type safety |
| **Build Tool** | Vite | Build r√°pido |
| **UI Library** | Material-UI (MUI) | Design system |
| **State Management** | React Query | Server state |
| **Forms** | React Hook Form + Zod | Formul√°rios validados |
| **HTTP Client** | Axios | API requests |
| **Roteamento** | React Router DOM | SPA routing |

### DevOps & Qualidade

- **Containeriza√ß√£o**: Docker
- **Testes**: Jest (Unit + Integration)
- **Linting**: ESLint + Prettier  
- **Type Safety**: TypeScript strict mode

---

## üîÑ Fluxo de Estados dos SKUs

| Status | Transi√ß√µes Poss√≠veis | Campos Edit√°veis | Observa√ß√µes |
|--------|---------------------|------------------|-------------|
| **PR√â-CADASTRO** | `CADASTRO_COMPLETO`, `CANCELADO` | `DESCRI√á√ÉO`, `DESCRI√á√ÉO_COMERCIAL`, `SKU` | Status inicial |
| **CADASTRO_COMPLETO** | `PR√â-CADASTRO`, `ATIVO`, `CANCELADO` | `DESCRI√á√ÉO_COMERCIAL` | Altera√ß√£o retorna para PR√â-CADASTRO |
| **ATIVO** | `DESATIVADO` | Nenhum | Nenhuma altera√ß√£o permitida |
| **DESATIVADO** | `ATIVO`, `PR√â-CADASTRO` | Nenhum | Nenhuma altera√ß√£o permitida |
| **CANCELADO** | Nenhum | Nenhum | Status definitivo |


## üìÑ **Part 3: Enterprise Refactoring & Installation (Fixed)**

```markdown
---

## üéØ Refatora√ß√£o

### ‚ú® Melhorias de Arquitetura Implementadas

#### 1. Sistema de Tratamento de Erros
```typescript
// Hierarquia de erros customizada
class ValidationError extends AppError { statusCode = 400; }
class BusinessRuleError extends AppError { statusCode = 422; }
class NotFoundError extends AppError { statusCode = 404; }
```

- **C√≥digos HTTP corretos** para cada tipo de erro
- **Classifica√ß√£o de erros** operacionais vs t√©cnicos  
- **Contexto estruturado** para debugging
- **Logging centralizado** com correlation IDs

#### 2. Middleware de Valida√ß√£o Centralizado
```typescript
// Valida√ß√£o autom√°tica antes dos controllers
router.post('/', validateRequest({ body: CreateSKUSchema }), SKUController.create);
```

- **Valida√ß√£o autom√°tica** de params, body e query
- **Erros padronizados** do Zod
- **Type safety** completa nos controllers

#### 3. Formato de Resposta Padronizado
```json
{
  "success": true,
  "data": { },
  "message": "SKU created successfully",
  "meta": {
    "timestamp": "2024-01-15T10:30:00.000Z"
  }
}
```

#### 4. Documenta√ß√£o Swagger Avan√ßada
- **Schemas reutiliz√°veis** para respostas de erro
- **Exemplos detalhados** para todos endpoints
- **C√≥digos de erro espec√≠ficos** (VALIDATION_ERROR, BUSINESS_RULE_VIOLATION)
- **Metadata de debugging** inclu√≠da

### üöÄ Padr√µes de Desenvolvimento S√™nior

- **Error-First Design**: Arquitetura que trata erros como cidad√£os de primeira classe
- **Type Safety Completa**: TypeScript strict mode com interfaces customizadas
- **Separation of Concerns**: Controllers apenas orquestram, Services cont√™m l√≥gica
- **Middleware Pipeline**: Valida√ß√£o, autentica√ß√£o, logging em camadas
- **Production-Ready Logging**: Logs estruturados com contexto completo

---

## üöÄ Como Executar

### Pr√©-requisitos

- **Node.js 18+**
- **Docker e Docker Compose**
- **Git**

### Instala√ß√£o R√°pida

```bash
# 1. Clone o reposit√≥rio
git clone https://github.com/PabloCGSilva/sku-management-boticario.git
cd sku-management

# 2. Execute o script de inicializa√ß√£o (Windows)
start-all.bat
```

### Execu√ß√£o Manual

#### Backend (API)

```bash
cd sku-api

# Instalar depend√™ncias
npm install

# Configurar ambiente
cp .env.example .env

# Iniciar com Docker (recomendado)
docker-compose up --build -d

# OU executar localmente
npm run build
npm start
```

#### Frontend (Web)

```bash
cd sku-web

# Instalar depend√™ncias
npm install

# Iniciar servidor de desenvolvimento
npm run dev
```


---

## üì° API Endpoints

### Principais Endpoints

| M√©todo | Endpoint | Descri√ß√£o | Valida√ß√£o |
|--------|----------|-----------|-----------|
| `GET` | `/api/skus` | Lista todos os SKUs | Query params validados |
| `POST` | `/api/skus` | Cria novo SKU | Body + Zod validation |
| `GET` | `/api/skus/:id` | Busca SKU por ID | CUID format validation |
| `PUT` | `/api/skus/:id` | Atualiza SKU | Params + Body validation |
| `DELETE` | `/api/skus/:id` | Remove SKU | CUID format validation |
| `GET` | `/health` | Health check | Dependency status |

**üìñ Documenta√ß√£o Completa**: http://localhost:3001/api-docs

### Exemplo de Resposta de Erro

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed: description is required",
    "details": {
      "details": [
        {
          "field": "description",
          "message": "String must contain at least 1 character(s)",
          "code": "too_small"
        }
      ],
      "totalErrors": 1
    }
  },
  "meta": {
    "timestamp": "2024-01-15T10:30:00.000Z",
    "path": "/api/skus",
    "method": "POST",
    "requestId": "req_123456789"
  }
}
```


## üß™ Cobertura de Testes

Este projeto implementa uma **estrat√©gia de testes abrangente** com diferentes n√≠veis de valida√ß√£o para garantir a qualidade e confiabilidade do sistema.

### üìä Tipos de Testes Implementados

| Tipo | Comando | Descri√ß√£o | Cobertura |
|------|---------|-----------|-----------|
| **Unit√°rios** | `npm run test:unit` | Testes isolados de fun√ß√µes e m√©todos | L√≥gica de neg√≥cio, valida√ß√µes |
| **Integra√ß√£o** | `npm run test:integration` | Testes de API end-to-end | Endpoints, fluxo completo |
| **State Machine** | `npm run test:state-machine` | Valida√ß√£o completa das regras de neg√≥cio | Transi√ß√µes de estado, permiss√µes |
| **Completos** | `npm run test:all` | Executa todos os testes em sequ√™ncia | Cobertura total do sistema |

### üéØ Detalhamento da Cobertura

#### 1. Testes Unit√°rios (test:unit)

```bash
npm run test:unit
```

**Arquivos testados:**
- `test/unit.test.js` - Testes b√°sicos de configura√ß√£o
- `test/simple.test.ts` - Valida√ß√µes de tipos e schemas

**Cobertura:**
- ‚úÖ Valida√ß√£o de schemas Zod
- ‚úÖ Tipos TypeScript
- ‚úÖ Configura√ß√£o do ambiente
- ‚úÖ Utilit√°rios e helpers

#### 2. Testes de Integra√ß√£o (test:integration)

```bash
npm run test:integration
```

**Arquivo:** `test/integration.test.js`

**Cobertura:**
- ‚úÖ **CRUD completo** - Create, Read, Update, Delete
- ‚úÖ **Regra especial** - Altera√ß√£o de descri√ß√£o comercial
- ‚úÖ **Valida√ß√£o de campos** - Permiss√µes por status
- ‚úÖ **Respostas da API** - C√≥digos HTTP e formato JSON
- ‚úÖ **Fluxo end-to-end** - Cria√ß√£o ‚Üí Transi√ß√£o ‚Üí Valida√ß√£o

**Cen√°rios testados:**
```
‚úÖ Cria√ß√£o de SKU com status inicial PRE_CADASTRO
‚úÖ Transi√ß√£o PRE_CADASTRO ‚Üí CADASTRO_COMPLETO  
‚úÖ Regra: commercialDescription em CADASTRO_COMPLETO ‚Üí PRE_CADASTRO
‚úÖ Valida√ß√£o de permiss√µes de edi√ß√£o por status
‚úÖ Valida√ß√£o de transi√ß√µes inv√°lidas
```

#### 3. Testes de State Machine (test:state-machine)

```bash
npm run test:state-machine
```

**Arquivo:** `test/sku-state-machine.test.js`

**Cobertura completa das regras de neg√≥cio do desafio t√©cnico:**

##### 3.1 Estado PRE_CADASTRO
- ‚úÖ Permite editar: `DESCRI√á√ÉO`, `DESCRI√á√ÉO_COMERCIAL`, `SKU`
- ‚úÖ Transi√ß√µes v√°lidas: `CADASTRO_COMPLETO`, `CANCELADO`
- ‚úÖ Valida todas as combina√ß√µes de campos edit√°veis

##### 3.2 Estado CADASTRO_COMPLETO
- ‚úÖ Permite editar: **apenas** `DESCRI√á√ÉO_COMERCIAL`
- ‚úÖ Regra especial: altera√ß√£o retorna para `PRE_CADASTRO`
- ‚úÖ Transi√ß√µes v√°lidas: `PRE_CADASTRO`, `ATIVO`, `CANCELADO`
- ‚úÖ Bloqueia edi√ß√£o de outros campos

##### 3.3 Estado ATIVO
- ‚úÖ **Nenhuma edi√ß√£o permitida** - todos os campos bloqueados
- ‚úÖ Transi√ß√£o v√°lida: apenas `DESATIVADO`
- ‚úÖ Valida rejei√ß√£o de altera√ß√µes de campos

##### 3.4 Estado DESATIVADO
- ‚úÖ **Nenhuma edi√ß√£o permitida** - todos os campos bloqueados  
- ‚úÖ Transi√ß√µes v√°lidas: `ATIVO`, `PRE_CADASTRO`
- ‚úÖ Valida rejei√ß√£o de altera√ß√µes de campos

##### 3.5 Estado CANCELADO
- ‚úÖ **Status definitivo** - nenhuma altera√ß√£o permitida
- ‚úÖ **Nenhuma transi√ß√£o v√°lida** - estado final
- ‚úÖ Valida rejei√ß√£o total de mudan√ßas

##### 3.6 Valida√ß√µes de Transi√ß√µes Inv√°lidas
- ‚úÖ Bloqueia transi√ß√µes n√£o permitidas
- ‚úÖ Retorna erros `422 BUSINESS_RULE_VIOLATION`
- ‚úÖ Mensagens espec√≠ficas por viola√ß√£o

### üéñÔ∏è Qualidade dos Testes

#### Padr√µes Profissionais Implementados:

1. **Isolamento de Testes**
   - Cada teste cria seus pr√≥prios dados
   - Cleanup autom√°tico ap√≥s execu√ß√£o
   - Sem depend√™ncias entre testes

2. **Cobertura de Edge Cases**
   - Todas as transi√ß√µes de estado poss√≠veis
   - Valida√ß√£o de campos por status
   - Cen√°rios de erro e sucesso

3. **Valida√ß√£o de Regras de Neg√≥cio**
   - 100% das regras do desafio t√©cnico
   - Casos especiais documentados
   - Comportamentos espec√≠ficos validados

4. **Assertions Robustas**
   - Valida√ß√£o de c√≥digos HTTP corretos
   - Verifica√ß√£o de estrutura de resposta
   - Contexto detalhado em falhas

### üìà M√©tricas de Cobertura

```bash
# Executar todos os testes
npm run test:all

# Resultado esperado:
‚úÖ Testes Unit√°rios: 100% dos utilit√°rios
‚úÖ Testes de Integra√ß√£o: 100% dos endpoints  
‚úÖ Testes de State Machine: 100% das regras de neg√≥cio
‚úÖ Total: 17+ cen√°rios validados
```

### üöÄ Executando os Testes

#### Pr√©-requisitos
- API rodando em `http://localhost:3001`
- Banco de dados PostgreSQL ativo
- Depend√™ncias instaladas (`npm install`)

#### Comandos Dispon√≠veis

```bash
# Testes r√°pidos (sem depend√™ncia da API)
npm run test:unit

# Testes completos de API (requer API ativa)
npm run test:integration

# Valida√ß√£o completa de regras de neg√≥cio
npm run test:state-machine

# Suite completa (recomendado antes de deploy)
npm run test:all
```

#### CI/CD Ready
Os testes est√£o preparados para integra√ß√£o cont√≠nua:
- ‚úÖ **Determin√≠sticos** - resultados consistentes
- ‚úÖ **R√°pidos** - execu√ß√£o em menos de 10s
- ‚úÖ **Informativos** - mensagens claras de erro
- ‚úÖ **Cleanup autom√°tico** - sem efeitos colaterais

---

## üéØ Funcionalidades Implementadas

### ‚úÖ Requisitos Obrigat√≥rios

- [x] API RESTful em TypeScript
- [x] Interface web em TypeScript
- [x] CRUD de SKUs
- [x] Fluxo de estados conforme especifica√ß√£o
- [x] Valida√ß√£o de campos edit√°veis por status
- [x] Banco de dados (PostgreSQL)

### ‚úÖ Diferenciais Implementados

- [x] **Testes unit√°rios e de integra√ß√£o** (TDD/BDD)
- [x] **Arquitetura distribu√≠da** (microservi√ßos)
- [x] **Containeriza√ß√£o com Docker**
- [x] **Documenta√ß√£o interativa** (Swagger)
- [x] **Logs estruturados** (Winston)
- [x] **Valida√ß√£o robusta** (Zod)
- [x] **Type Safety** completo
- [x] **State Machine Pattern**
- [x] **Responsive Design**

### üèÜ Melhorias Implementadas

- [x] **Error Handling Architecture** - Hierarquia de erros com c√≥digos HTTP corretos
- [x] **Centralized Validation** - Middleware de valida√ß√£o autom√°tica
- [x] **Standardized Responses** - Formato consistente para sucesso e erro
- [x] **Production Logging** - Logs estruturados com correlation IDs
- [x] **Advanced Swagger** - Documenta√ß√£o com exemplos e schemas reutiliz√°veis
- [x] **Type Safety Completa** - Interfaces customizadas para Request/Response

---

## üíº Decis√µes T√©cnicas

### Por que essas tecnologias?

1. **TypeScript**: Type safety, melhor DX, menos bugs em produ√ß√£o
2. **Prisma**: Type-safe database access, migrations autom√°ticas
3. **React Query**: Cache inteligente, sincroniza√ß√£o autom√°tica
4. **Material-UI**: Design system consistente, acessibilidade
5. **Docker**: Ambiente consistente, f√°cil deployment

### Padr√µes Aplicados

- **SOLID**: Separa√ß√£o de responsabilidades, dependency injection
- **State Machine**: Controle rigoroso de transi√ß√µes de estado
- **Repository Pattern**: Abstra√ß√£o da camada de dados
- **Error-First Design**: Tratamento centralizado de erros
- **Middleware Pipeline**: Valida√ß√£o e logging em camadas

---

## üîß Configura√ß√£o do Ambiente

### Vari√°veis de Ambiente (Backend)

```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/sku_management"
PORT=3001
NODE_ENV=development
CORS_ORIGIN="http://localhost:3000"
```

---

## üìä Estrutura do Projeto

### Backend structure (sku-api)

```
src/
‚îú‚îÄ‚îÄ controllers/     # Controladores da API (apenas orquestra√ß√£o)
‚îú‚îÄ‚îÄ services/        # L√≥gica de neg√≥cio e regras
‚îú‚îÄ‚îÄ models/          # Defini√ß√µes de tipos e schemas Zod
‚îú‚îÄ‚îÄ routes/          # Defini√ß√£o das rotas com valida√ß√£o
‚îú‚îÄ‚îÄ middleware/      # Middlewares (validation, errorHandler)
‚îú‚îÄ‚îÄ errors/          # Hierarquia de erros customizada
‚îú‚îÄ‚îÄ utils/           # Utilit√°rios e helpers
‚îú‚îÄ‚îÄ config/          # Configura√ß√µes (Swagger, etc)
‚îî‚îÄ‚îÄ index.ts         # Entrada da aplica√ß√£o
```

### Frontend structure (sku-web)

```
src/
‚îú‚îÄ‚îÄ components/      # Componentes reutiliz√°veis
‚îú‚îÄ‚îÄ pages/           # P√°ginas da aplica√ß√£o
‚îú‚îÄ‚îÄ hooks/           # Custom hooks (React Query)
‚îú‚îÄ‚îÄ services/        # Cliente da API
‚îú‚îÄ‚îÄ types/           # Defini√ß√µes de tipos TypeScript
‚îú‚îÄ‚îÄ utils/           # Utilit√°rios e valida√ß√µes
‚îî‚îÄ‚îÄ App.tsx          # Componente principal
```

---

## üéñÔ∏è Demonstra√ß√£o de Maturidade T√©cnica

Este projeto demonstra conhecimento atrav√©s de:

- **Arquitetura de Erros**: Sistema profissional com hierarquia de classes
- **Middleware Design**: Pipeline de valida√ß√£o e tratamento
- **Type Safety Avan√ßado**: TypeScript com interfaces customizadas
- **Production Patterns**: Logging, health checks, documenta√ß√£o
- **Clean Code**: Separa√ß√£o de responsabilidades clara
- **API Design**: RESTful com c√≥digos HTTP sem√¢nticos
- **Testing Strategy**: Cobertura completa de regras de neg√≥cio

---

